name: shardoverse

on:
  push:
  pull_request:
    branches:
      - master

jobs:
  test_Ubuntu:

    runs-on: ubuntu-latest

    steps:
    - name: Install SDL2-libs
    - uses: actions/checkout@v1
      run: |
        sudo apt-get update
        sudo apt-get install libsdl2-dev libsdl2-image-dev libsdl2-ttf-dev libsdl2-mixer-dev libsdl2-gfx-dev 
    - name: Build on Ubuntu
    - uses: actions-rs/cargo@v1
      with:
        command: build

    - name: Run Tests on Ubuntu
    - uses: actions-rs/cargo@v1
      with:
        command: test
      
  test_MacOS:

    runs-on: macOS-latest
    
    steps:
    - uses: actions/checkout@v1
    - name: install_dependencies
      run: | 
        brew install rustup
        rustup-init -y --default-toolchain stable        
        wget https://www.libsdl.org/release/SDL2-2.0.12.tar.gz -O sdl2.tar.gz
        tar xzf sdl2.tar.gz
        pushd SDL2-* && ./configure && make && sudo make install && popd
        wget https://www.libsdl.org/projects/SDL_ttf/release/SDL2_ttf-2.0.15.tar.gz -O sdl2_ttf.tar.gz
        tar xzf sdl2_ttf.tar.gz
        pushd SDL2_ttf-* && ./configure && make && sudo make install && popd
        wget https://www.libsdl.org/projects/SDL_image/release/SDL2_image-2.0.5.tar.gz -O SDL2_image.tar.gz
        tar xzf SDL2_image.tar.gz
        pushd SDL2_image-* && ./configure && make && sudo make install && popd
        wget https://www.libsdl.org/projects/SDL_mixer/release/SDL2_mixer-2.0.4.tar.gz -O sdl2_mixer.tar.gz
        tar xzf sdl2_mixer.tar.gz
        pushd SDL2_mixer-* && ./configure && make && sudo make install && popd
        wget --content-disposition -c https://sourceforge.net/projects/sdl2gfx/files/SDL2_gfx-1.0.4.tar.gz -O sdl2_gfx.tar.gz 
        tar xzf sdl2_gfx.tar.gz
        pushd SDL2_gfx-*/ && ./configure && make && sudo make install && popd
    - name: Build
      run: |
        export PATH="$HOME/.cargo/bin:$PATH"
        export LD_LIBRARY_PATH="/usr/local/lib/:$LD_LIBRARY_PATH"
        echo "LD_LIBRARY_PATH=$LD_LIBRARY_PATH"
        cargo build
    - name: Test
      run: |
        export PATH="$HOME/.cargo/bin:$PATH"
        export LD_LIBRARY_PATH="/usr/local/lib/:$LD_LIBRARY_PATH"
        echo "LD_LIBRARY_PATH=$LD_LIBRARY_PATH"
        cargo test
      
  test_Windows:
    runs-on: windows-2016
    
    steps:
    - uses: actions/checkout@v1
    - name: Build
      run: cargo build
    - name: Test
      run: cargo test
